
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>moddb.base &#8212; moddb 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for moddb.base</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">.enums</span> <span class="k">import</span> <span class="n">SearchCategory</span><span class="p">,</span> <span class="n">ThumbnailType</span>
<span class="kn">from</span> <span class="nn">.boxes</span> <span class="k">import</span> <span class="n">Thumbnail</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">soup</span><span class="p">,</span> <span class="n">LOGGER</span><span class="p">,</span> <span class="n">normalize</span>
<span class="kn">from</span> <span class="nn">.pages</span> <span class="k">import</span> <span class="n">FrontPage</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">robobrowser</span> <span class="k">import</span> <span class="n">RoboBrowser</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Search&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">,</span> <span class="s2">&quot;parse&quot;</span><span class="p">,</span> <span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="s2">&quot;logout&quot;</span><span class="p">,</span> <span class="s2">&quot;front_page&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="Search"><a class="viewcode-back" href="../../base.html#moddb.base.Search">[docs]</a><span class="k">class</span> <span class="nc">Search</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Represents the search you just conducted through the library&#39;s search function. Can be used to navigate </span>
<span class="sd">    the search page efficiently.</span>

<span class="sd">    Attributes</span>
<span class="sd">    -----------</span>
<span class="sd">    results : List[Thumbnail]</span>
<span class="sd">        The list of results the search returned</span>

<span class="sd">    category : ThumbnailType</span>
<span class="sd">        The type results</span>

<span class="sd">    filters : dict{str : Enum}</span>
<span class="sd">        The dict of filters that was used to search for the results</span>

<span class="sd">    page_max : int</span>
<span class="sd">        The number of pages</span>

<span class="sd">    page : int</span>
<span class="sd">        The current page, range is 1-page_max included</span>

<span class="sd">    query : str</span>
<span class="sd">        The text query that was used in the search</span>

<span class="sd">    results_max : int</span>
<span class="sd">        The total number of results for this search</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filters&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page_max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_max&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results_max&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Search.next_page"><a class="viewcode-back" href="../../base.html#moddb.base.Search.next_page">[docs]</a>    <span class="k">def</span> <span class="nf">next_page</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Search&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a new search object with the next page of results, will raise ValueError </span>
<span class="sd">        if the last page is the current one</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Search</span>
<span class="sd">            The new search objects containing a new set of results.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            There is no next page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_max</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Reached last page already&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">to_page</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Search.previous_page"><a class="viewcode-back" href="../../base.html#moddb.base.Search.previous_page">[docs]</a>    <span class="k">def</span> <span class="nf">previous_page</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Search&#39;</span><span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;Returns a new search object with the previous page of results, will raise </span>
<span class="sd">        ValueError if the first page is the current one</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Search</span>
<span class="sd">            The new search objects containing a new set of results.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            There is no previous page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Reached first page already&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_page</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Search.to_page"><a class="viewcode-back" href="../../base.html#moddb.base.Search.to_page">[docs]</a>    <span class="k">def</span> <span class="nf">to_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span> <span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Search&#39;</span><span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;Returns a new search object with results to a specific page in the search results </span>
<span class="sd">        allowing for fast navigation. Will raise ValueError if you attempt to navigate out </span>
<span class="sd">        of bounds.</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        page : int</span>
<span class="sd">            A page number within the range 1 - page_max inclusive</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Search</span>
<span class="sd">            The new search objects containing a new set of results.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            This page does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">page</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_max</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Please pick a page between 1 and </span><span class="si">{self.page_max}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span></div>

<div class="viewcode-block" id="Search.resort"><a class="viewcode-back" href="../../base.html#moddb.base.Search.resort">[docs]</a>    <span class="k">def</span> <span class="nf">resort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_sort</span> <span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Search&#39;</span><span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;Allows you to sort the whole search by a new sorting parameters. Returns a new search object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        new_sort : Tuple[str, str]</span>
<span class="sd">            The new sorting tuple to check by</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Search</span>
<span class="sd">            The new set of results with the updated sort order</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">new_sort</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;&lt;Search results={len(self.results)}/</span><span class="si">{self.results_max}</span><span class="s2">, category=</span><span class="si">{self.category.name}</span><span class="s2"> pages=</span><span class="si">{self.page}</span><span class="s2">/</span><span class="si">{self.page_max}</span><span class="s2">&gt;&quot;</span></div>


<div class="viewcode-block" id="search"><a class="viewcode-back" href="../../base.html#moddb.base.search">[docs]</a><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">category</span> <span class="p">:</span> <span class="n">SearchCategory</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">query</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sort</span> <span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">page</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">filters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Search</span><span class="p">:</span> 
    <span class="sd">&quot;&quot;&quot; Search for for a certain type of models and return a list of thumbnails of that </span>
<span class="sd">    model. This function was created to make full use of moddb&#39;s filter and sorting system as</span>
<span class="sd">    long as the appropriate parameters are passed. Because this function is a single one for every</span>
<span class="sd">    model type in moddb the parameters that can be passed vary between model type but the</span>
<span class="sd">    documentation will do its best to document all the possibilities. All the objects listed in this</span>
<span class="sd">    function are enumerations. Finally it is key to note that the result attribute of the returned search</span>
<span class="sd">    object is not a list of the parsed pages but a list of Thumbnail objects containing the image, url,</span>
<span class="sd">    name and type of the object on which. Call the thumbnail&#39;s parse method and it will return the full model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    category : SearchCategory</span>
<span class="sd">        The model type that you want to search</span>

<span class="sd">    query : str</span>
<span class="sd">        String to search for in the model title</span>
<span class="sd">    </span>
<span class="sd">    sort : Tuple[str, str]</span>
<span class="sd">        The tuple to sort by, look at the models your are searching for documentation </span>
<span class="sd">        on sorting.</span>

<span class="sd">    page : int</span>
<span class="sd">        The page of results to get first</span>

<span class="sd">    filters : dict</span>
<span class="sd">        Search filters</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    Search</span>
<span class="sd">        The search object containing the current query settings (so at to be able to redo the search easily),</span>
<span class="sd">        pagination metadata and helper methods to navigate the list of results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{sort[0]}</span><span class="s2">-</span><span class="si">{sort[1]}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">sort</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">game</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;game&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">game</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">game</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;https://www.com/</span><span class="si">{category.name}</span><span class="s2">/page/</span><span class="si">{page}</span><span class="s2">&quot;</span>
    <span class="n">filter_parsed</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">cat</span> <span class="o">=</span> <span class="n">ThumbnailType</span><span class="p">[</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">html</span> <span class="o">=</span> <span class="n">soup</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;kw&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="n">sort</span><span class="p">,</span> <span class="s2">&quot;game&quot;</span><span class="p">:</span> <span class="n">game</span><span class="p">,</span> <span class="o">**</span><span class="n">filter_parsed</span><span class="p">})</span>

    <span class="n">search_raws</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s2">&quot;pages&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">])</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">Thumbnail</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="n">cat</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">search_raws</span><span class="p">]</span>
    <span class="n">results_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;h5&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">())</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">string</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">Search</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">page_max</span><span class="o">=</span><span class="n">pages</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> 
                  <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">results_max</span><span class="o">=</span><span class="n">results_max</span><span class="p">)</span></div>

<div class="viewcode-block" id="parse"><a class="viewcode-back" href="../../base.html#moddb.base.parse">[docs]</a><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">url</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">page_type</span> <span class="p">:</span> <span class="n">ThumbnailType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> 
    <span class="sd">&quot;&quot;&quot;Parse a url and return the appropriate object. The function will attempt to figure out the page itself</span>
<span class="sd">    from the url and the content of the page but ModDB is not always consistent with this. In which case</span>
<span class="sd">    it is recommended to pass a Thumbnail enum to the `page_type` kwarg.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    url : str</span>
<span class="sd">        The url to parse</span>

<span class="sd">    page_type : Optional[ThumbnailType]</span>
<span class="sd">        The type of the page you are parsing, used to decide which model to parse the html with</span>
<span class="sd">        can be left blank to let the function take care of it but might not always lead to the</span>
<span class="sd">        correct result.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    Model</span>
<span class="sd">        The parsed page as the instance of the model the page represents, can be anything like</span>
<span class="sd">        Mod or Game</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\/([a-z]+)\/&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">soup</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">type_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;new&quot;</span><span class="p">:</span> <span class="s2">&quot;article&quot;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">page_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">matches</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>      

        <span class="k">try</span><span class="p">:</span>
            <span class="n">page_type</span> <span class="o">=</span> <span class="n">ThumbnailType</span><span class="p">[</span><span class="n">match</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">page_type</span> <span class="o">=</span> <span class="n">ThumbnailType</span><span class="p">[</span><span class="n">type_mapping</span><span class="p">[</span><span class="n">match</span><span class="p">]]</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">page_type</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;moddb&quot;</span><span class="p">],</span> <span class="n">page_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">())(</span><span class="n">html</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span></div>


<div class="viewcode-block" id="login"><a class="viewcode-back" href="../../base.html#moddb.base.login">[docs]</a><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">username</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span> <span class="p">:</span> <span class="nb">str</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Login the user to moddb through the library, this allows user to see guest comments and see</span>
<span class="sd">    private groups they are part of.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    username : str</span>
<span class="sd">        The username of the user</span>

<span class="sd">    password : str</span>
<span class="sd">        The password associated to that username</span>

<span class="sd">    Raises</span>
<span class="sd">    -------</span>
<span class="sd">    ValueError</span>
<span class="sd">        The password or username was incorrect</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">browser</span> <span class="o">=</span> <span class="n">RoboBrowser</span><span class="p">(</span><span class="n">history</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;https://www.com/members/login&#39;</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">browser</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;membersusername&quot;</span><span class="p">))</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;membersform&quot;</span><span class="p">})</span>

    <span class="n">form</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">password</span>
    <span class="n">form</span><span class="p">[</span><span class="s2">&quot;referer&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">form</span><span class="p">[</span><span class="n">browser</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;membersusername&quot;</span><span class="p">)[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">username</span>
    <span class="n">form</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">browser</span><span class="o">.</span><span class="n">submit_form</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;moddb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">SESSION</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">session</span>

    <span class="k">if</span> <span class="s2">&quot;freeman&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">browser</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Login failed for user </span><span class="si">{username}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="logout"><a class="viewcode-back" href="../../base.html#moddb.base.logout">[docs]</a><span class="k">def</span> <span class="nf">logout</span><span class="p">():</span> 
    <span class="sd">&quot;&quot;&quot;Logs the user out by clearing the cookies, all unapproved guest commnets will be hidden and </span>
<span class="sd">    all private groups will be hidden once more</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;moddb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">SESSION</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="front_page"><a class="viewcode-back" href="../../base.html#moddb.base.front_page">[docs]</a><span class="k">def</span> <span class="nf">front_page</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">FrontPage</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This returns a model representing the front page of  May sound fancy but it is no more</span>
<span class="sd">    than a collection of popular mods, files, games and articles. In addition jobs are listed (but</span>
<span class="sd">    not linked so unparsable) and a poll.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    FrontPage</span>
<span class="sd">        The front page object.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">soup</span><span class="p">(</span><span class="s2">&quot;https://www.com/&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FrontPage</span><span class="p">(</span><span class="n">html</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">moddb</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filtering&amp;sorting.html">Filtering and Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base.html">Key Functions &amp; Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages.html">ModDB Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boxes.html">ModDB Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../enums.html">ModDB Enums</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Clement Julia.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>